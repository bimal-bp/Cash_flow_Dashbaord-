<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGX - Aging Report Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a237e; /* Navy blue */
            --secondary: #ff9800; /* Orange */
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --gray: #95a5a6;
            --gradient-start: #1a237e; /* Navy blue */
            --gradient-end: #283593; /* Darker navy blue */
            --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
            --hover-shadow: 0 15px 30px rgba(0,0,0,0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            color: #333;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(30deg);
        }
        
        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-text h1 {
            font-size: 36px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .header-icon {
            font-size: 48px;
            opacity: 0.8;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            border-radius: 50px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
        }
        
        .summary-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
        }
        
        .summary-card:nth-child(1)::before { background: var(--success); }
        .summary-card:nth-child(2)::before { background: var(--danger); }
        .summary-card:nth-child(3)::before { background: var(--warning); }
        .summary-card:nth-child(4)::before { background: var(--primary); }
        .summary-card:nth-child(5)::before { background: #9b59b6; }
        .summary-card:nth-child(6)::before { background: #3498db; }
        .summary-card:nth-child(7)::before { background: #1abc9c; }
        .summary-card:nth-child(8)::before { background: #d35400; }
        
        .summary-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--hover-shadow);
        }
        
        .card-icon {
            font-size: 28px;
            margin-bottom: 15px;
            opacity: 0.8;
        }
        
        .card-title {
            font-size: 16px;
            color: var(--gray);
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .positive {
            color: var(--success);
        }
        
        .negative {
            color: var(--danger);
        }
        
        .neutral {
            color: var(--primary);
        }
        
        .card-description {
            font-size: 14px;
            color: var(--gray);
        }
        
        .transaction-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 24px;
            color: var(--primary);
            font-weight: 700;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary);
            display: inline-block;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 15px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            font-weight: 700;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 13px;
            border-radius: 15px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }
        
        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 700;
            color: var(--primary);
            font-size: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            border-bottom: 2px solid var(--primary);
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .summary-row {
            background-color: #f8f9fa;
            font-weight: 700;
            font-size: 16px;
            border-top: 2px solid var(--primary);
        }
        
        .date-col {
            width: 120px;
        }
        
        .amount-col {
            width: 120px;
            text-align: right;
        }
        
        .actions-col {
            width: 150px;
            text-align: center;
        }
        
        .cash-inflow-cell {
            color: var(--success);
            font-weight: 700;
        }
        
        .cash-outflow-cell {
            color: var(--danger);
            font-weight: 700;
        }
        
        .net-balance-cell {
            color: var(--primary);
            font-weight: 700;
        }
        
        .date-display {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-title {
            font-size: 22px;
            color: var(--primary);
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        /* Filter styles */
        .filter-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid var(--primary);
            transition: all 0.3s ease;
            font-weight: 700;
            background: white;
            color: var(--primary);
        }
        
        .filter-option.active {
            background-color: var(--primary);
            color: white;
        }
        
        /* Entry form styles */
        .entry-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }
        
        .form-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-actions {
            grid-column: 1 / -1;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .aging-0-30 { background-color: rgba(46, 204, 113, 0.1); }
        .aging-30-45 { background-color: rgba(243, 156, 18, 0.1); }
        .aging-45-60 { background-color: rgba(231, 76, 60, 0.1); }
        .aging-60-90 { background-color: rgba(155, 89, 182, 0.1); }
        .aging-90-120 { background-color: rgba(52, 152, 219, 0.1); }
        .aging-120-365 { background-color: rgba(26, 188, 156, 0.1); }
        .aging-over-365 { background-color: rgba(211, 84, 0, 0.1); }
        
        @media (max-width: 1024px) {
            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            th, td {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            .card-value {
                font-size: 30px;
            }
            
            .header-text h1 {
                font-size: 28px;
            }
            
            .date-display {
                position: static;
                margin-top: 15px;
                text-align: center;
            }
            
            .entry-form {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                justify-content: center;
            }
            
            table {
                font-size: 12px;
            }
        }
        
        /* Animation for numbers */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-value {
            animation: countUp 0.5s ease-out;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-size: 14px;
        }
        
        .customer-name-col {
            width: 200px;
        }
        
        .aging-col {
            width: 110px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <div class="header-content">
                <div class="header-text">
                    <h1>SGX - Aging Report Dashboard</h1>
                    <div class="subtitle">Aggregate Billed Outstanding Aging - September 2025</div>
                </div>
                <div class="header-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="date-display">
                <i class="fas fa-calendar-alt"></i> September 25, 2025
            </div>
        </header>
        
        <div class="summary-cards">
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-file-invoice-dollar neutral"></i>
                </div>
                <div class="card-title">Total Billed OS</div>
                <div class="card-value neutral">₹6,30,27,686</div>
                <div class="card-description">Total Billed Outstanding</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-exclamation-triangle negative"></i>
                </div>
                <div class="card-title">Total Overdue OS</div>
                <div class="card-value negative">₹2,85,87,184</div>
                <div class="card-description">Total Overdue Outstanding</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-check-circle positive"></i>
                </div>
                <div class="card-title">Not Due Amount</div>
                <div class="card-value positive">₹3,44,40,502</div>
                <div class="card-description">Amount Not Yet Due</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-receipt neutral"></i>
                </div>
                <div class="card-title">Total Unbilled</div>
                <div class="card-value neutral">₹66,33,314</div>
                <div class="card-description">Unbilled Amount</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-clock warning"></i>
                </div>
                <div class="card-title">30-45 Days</div>
                <div class="card-value warning">₹1,57,28,477</div>
                <div class="card-description">Aging 30-45 Days</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-hourglass-half warning"></i>
                </div>
                <div class="card-title">45-60 Days</div>
                <div class="card-value warning">₹24,91,536</div>
                <div class="card-description">Aging 45-60 Days</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-exclamation-circle negative"></i>
                </div>
                <div class="card-title">60-90 Days</div>
                <div class="card-value negative">₹36,27,701</div>
                <div class="card-description">Aging 60-90 Days</div>
            </div>
            <div class="summary-card">
                <div class="card-icon">
                    <i class="fas fa-times-circle negative"></i>
                </div>
                <div class="card-title">90+ Days</div>
                <div class="card-value negative">₹1,57,27,083</div>
                <div class="card-description">Aging 90+ Days</div>
            </div>
        </div>
        
        <div class="transaction-section">
            <div class="section-header">
                <div class="section-title">Customer Aging Details</div>
                <div class="section-actions">
                    <button class="btn btn-success" id="addEntryBtn"><i class="fas fa-plus"></i> Add Customer</button>
                    <button class="btn btn-outline" id="exportBtn"><i class="fas fa-download"></i> Export</button>
                    <button class="btn btn-primary" id="filterBtn"><i class="fas fa-filter"></i> Filter</button>
                </div>
            </div>
            
            <div class="filter-options" id="filterOptions">
                <div class="filter-option active" data-filter="all">
                    <i class="fas fa-list"></i> All Customers
                </div>
                <div class="filter-option" data-filter="overdue">
                    <i class="fas fa-exclamation-triangle"></i> Overdue Only
                </div>
                <div class="filter-option" data-filter="high-risk">
                    <i class="fas fa-radiation"></i> High Risk (90+ Days)
                </div>
            </div>
            
            <table id="transactionTable">
                <thead>
                    <tr>
                        <th class="customer-name-col">Customer Name</th>
                        <th class="amount-col">Billed OS</th>
                        <th class="amount-col">Overdue OS</th>
                        <th class="amount-col">Not Due</th>
                        <th class="amount-col aging-col">0-30 Days</th>
                        <th class="amount-col aging-col">30-45 Days</th>
                        <th class="amount-col aging-col">45-60 Days</th>
                        <th class="amount-col aging-col">60-90 Days</th>
                        <th class="amount-col aging-col">90-120 Days</th>
                        <th class="amount-col aging-col">120-365 Days</th>
                        <th class="amount-col">Unbilled</th>
                        <th class="actions-col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            SGX Financial Dashboard | Generated on September 25, 2025 | <i class="fas fa-sync-alt"></i> Updated in real-time
        </div>
    </div>

    <!-- Add Entry Modal -->
    <div class="modal" id="addEntryModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Customer</div>
                <button class="close-btn" id="closeAddModal">&times;</button>
            </div>
            <form id="entryForm">
                <div class="entry-form">
                    <div class="form-group full-width">
                        <label class="form-label">Customer Name</label>
                        <input type="text" class="form-input" id="entryCustomer" placeholder="Enter customer name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Billed OS (₹)</label>
                        <input type="number" class="form-input" id="entryBilled" placeholder="Enter amount" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Overdue OS (₹)</label>
                        <input type="number" class="form-input" id="entryOverdue" placeholder="Enter amount" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">0-30 Days (₹)</label>
                        <input type="number" class="form-input" id="entry0to30" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">30-45 Days (₹)</label>
                        <input type="number" class="form-input" id="entry30to45" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">45-60 Days (₹)</label>
                        <input type="number" class="form-input" id="entry45to60" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">60-90 Days (₹)</label>
                        <input type="number" class="form-input" id="entry60to90" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">90-120 Days (₹)</label>
                        <input type="number" class="form-input" id="entry90to120" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">120-365 Days (₹)</label>
                        <input type="number" class="form-input" id="entry120to365" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unbilled (₹)</label>
                        <input type="number" class="form-input" id="entryUnbilled" placeholder="Enter amount">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancelEntry">Cancel</button>
                        <button type="submit" class="btn btn-success">Add Customer</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Aging data storage
        let agingData = [
            { 
                id: 1, 
                customer: "L&T Construction Division", 
                billed: 18205996, 
                overdue: 8978938, 
                notDue: 9227058, 
                aging0to30: 9207058, 
                aging30to45: 6600252, 
                aging45to60: 914, 
                aging60to90: 1572, 
                aging90to120: 3220, 
                aging120to365: 2372980, 
                unbilled: 595513 
            },
            { 
                id: 2, 
                customer: "L&T Geo Structure", 
                billed: 4686118, 
                overdue: 4686118, 
                notDue: 0, 
                aging0to30: 0, 
                aging30to45: 0, 
                aging45to60: 0, 
                aging60to90: 2324952, 
                aging90to120: 1771248, 
                aging120to365: 589918, 
                unbilled: 0 
            },
            { 
                id: 3, 
                customer: "KEC International Ltd", 
                billed: 7519018, 
                overdue: 1224434, 
                notDue: 6294584, 
                aging0to30: 6294584, 
                aging30to45: 0, 
                aging45to60: 0, 
                aging60to90: 113943, 
                aging90to120: 38775, 
                aging120to365: 1071716, 
                unbilled: 733261 
            },
            { 
                id: 4, 
                customer: "Northstar Homes", 
                billed: 5137457, 
                overdue: 4984887, 
                notDue: 152570, 
                aging0to30: 152570, 
                aging30to45: 0, 
                aging45to60: 0, 
                aging60to90: 0, 
                aging90to120: 0, 
                aging120to365: 4984887, 
                unbilled: 69968 
            },
            { 
                id: 5, 
                customer: "Arvind Techno Infra", 
                billed: 3043506, 
                overdue: 2546441, 
                notDue: 497065, 
                aging0to30: 497065, 
                aging30to45: 0, 
                aging45to60: 1521314, 
                aging60to90: 822156, 
                aging90to120: 169907, 
                aging120to365: 33064, 
                unbilled: 598789 
            }
        ];

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Animate summary card numbers
            const cardValues = document.querySelectorAll('.card-value');
            
            cardValues.forEach(value => {
                const originalText = value.textContent;
                value.textContent = '0';
                
                setTimeout(() => {
                    value.textContent = originalText;
                }, 100);
            });
            
            // Populate the table with data
            updateAgingTable();
            
            // Filter functionality
            const filterOptions = document.querySelectorAll('.filter-option');
            
            filterOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove active class from all options
                    filterOptions.forEach(opt => opt.classList.remove('active'));
                    // Add active class to clicked option
                    this.classList.add('active');
                    
                    const filter = this.getAttribute('data-filter');
                    filterAgingData(filter);
                });
            });
            
            // Modal functionality
            const addEntryModal = document.getElementById('addEntryModal');
            const addEntryBtn = document.getElementById('addEntryBtn');
            const closeAddModal = document.getElementById('closeAddModal');
            const cancelEntry = document.getElementById('cancelEntry');
            const entryForm = document.getElementById('entryForm');
            
            addEntryBtn.addEventListener('click', function() {
                addEntryModal.style.display = 'flex';
            });
            
            closeAddModal.addEventListener('click', function() {
                addEntryModal.style.display = 'none';
                entryForm.reset();
            });
            
            cancelEntry.addEventListener('click', function() {
                addEntryModal.style.display = 'none';
                entryForm.reset();
            });
            
            // Handle form submission for adding new customer
            entryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const customer = document.getElementById('entryCustomer').value;
                const billed = parseInt(document.getElementById('entryBilled').value) || 0;
                const overdue = parseInt(document.getElementById('entryOverdue').value) || 0;
                const aging0to30 = parseInt(document.getElementById('entry0to30').value) || 0;
                const aging30to45 = parseInt(document.getElementById('entry30to45').value) || 0;
                const aging45to60 = parseInt(document.getElementById('entry45to60').value) || 0;
                const aging60to90 = parseInt(document.getElementById('entry60to90').value) || 0;
                const aging90to120 = parseInt(document.getElementById('entry90to120').value) || 0;
                const aging120to365 = parseInt(document.getElementById('entry120to365').value) || 0;
                const unbilled = parseInt(document.getElementById('entryUnbilled').value) || 0;
                
                const notDue = billed - overdue;
                
                const newCustomer = {
                    id: agingData.length > 0 ? Math.max(...agingData.map(t => t.id)) + 1 : 1,
                    customer: customer,
                    billed: billed,
                    overdue: overdue,
                    notDue: notDue,
                    aging0to30: aging0to30,
                    aging30to45: aging30to45,
                    aging45to60: aging45to60,
                    aging60to90: aging60to90,
                    aging90to120: aging90to120,
                    aging120to365: aging120to365,
                    unbilled: unbilled
                };
                
                agingData.push(newCustomer);
                
                // Update the table
                updateAgingTable();
                
                // Update summary cards
                updateSummaryCards();
                
                // Close modal and reset form
                addEntryModal.style.display = 'none';
                entryForm.reset();
                
                alert('Customer added successfully!');
            });
            
            // Export functionality
            document.getElementById('exportBtn').addEventListener('click', function() {
                const exportData = [
                    ['Customer Name', 'Billed OS', 'Overdue OS', 'Not Due', '0-30 Days', '30-45 Days', '45-60 Days', '60-90 Days', '90-120 Days', '120-365 Days', 'Unbilled']
                ];
                
                // Add customers to export data
                agingData.forEach(customer => {
                    exportData.push([
                        customer.customer,
                        customer.billed.toLocaleString('en-IN'),
                        customer.overdue.toLocaleString('en-IN'),
                        customer.notDue.toLocaleString('en-IN'),
                        customer.aging0to30.toLocaleString('en-IN'),
                        customer.aging30to45.toLocaleString('en-IN'),
                        customer.aging45to60.toLocaleString('en-IN'),
                        customer.aging60to90.toLocaleString('en-IN'),
                        customer.aging90to120.toLocaleString('en-IN'),
                        customer.aging120to365.toLocaleString('en-IN'),
                        customer.unbilled.toLocaleString('en-IN')
                    ]);
                });
                
                // Add summary row
                const totalBilled = agingData.reduce((sum, c) => sum + c.billed, 0);
                const totalOverdue = agingData.reduce((sum, c) => sum + c.overdue, 0);
                const totalNotDue = agingData.reduce((sum, c) => sum + c.notDue, 0);
                const total0to30 = agingData.reduce((sum, c) => sum + c.aging0to30, 0);
                const total30to45 = agingData.reduce((sum, c) => sum + c.aging30to45, 0);
                const total45to60 = agingData.reduce((sum, c) => sum + c.aging45to60, 0);
                const total60to90 = agingData.reduce((sum, c) => sum + c.aging60to90, 0);
                const total90to120 = agingData.reduce((sum, c) => sum + c.aging90to120, 0);
                const total120to365 = agingData.reduce((sum, c) => sum + c.aging120to365, 0);
                const totalUnbilled = agingData.reduce((sum, c) => sum + c.unbilled, 0);
                
                exportData.push([
                    'Total',
                    totalBilled.toLocaleString('en-IN'),
                    totalOverdue.toLocaleString('en-IN'),
                    totalNotDue.toLocaleString('en-IN'),
                    total0to30.toLocaleString('en-IN'),
                    total30to45.toLocaleString('en-IN'),
                    total45to60.toLocaleString('en-IN'),
                    total60to90.toLocaleString('en-IN'),
                    total90to120.toLocaleString('en-IN'),
                    total120to365.toLocaleString('en-IN'),
                    totalUnbilled.toLocaleString('en-IN')
                ]);
                
                // Create a CSV string
                let csvContent = "data:text/csv;charset=utf-8,";
                exportData.forEach(row => {
                    csvContent += row.join(",") + "\r\n";
                });
                
                // Create a download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "SGX_Aging_Report_September2025.csv");
                document.body.appendChild(link);
                
                // Trigger the download
                link.click();
                document.body.removeChild(link);
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === addEntryModal) {
                    addEntryModal.style.display = 'none';
                    entryForm.reset();
                }
            });
            
            // Function to filter aging data
            function filterAgingData(filter) {
                let filteredData = [...agingData];
                
                if (filter === 'overdue') {
                    filteredData = agingData.filter(customer => customer.overdue > 0);
                } else if (filter === 'high-risk') {
                    filteredData = agingData.filter(customer => 
                        customer.aging60to90 > 0 || 
                        customer.aging90to120 > 0 || 
                        customer.aging120to365 > 0
                    );
                }
                
                updateAgingTable(filteredData);
            }
            
            // Function to update aging table
            function updateAgingTable(data = agingData) {
                const tbody = document.querySelector('#transactionTable tbody');
                // Clear existing rows
                tbody.innerHTML = '';
                
                // Add customers to table
                data.forEach(customer => {
                    const row = document.createElement('tr');
                    
                    // Determine row class based on overdue status
                    if (customer.overdue > 0) {
                        if (customer.aging120to365 > 0) {
                            row.classList.add('aging-over-365');
                        } else if (customer.aging90to120 > 0) {
                            row.classList.add('aging-90-120');
                        } else if (customer.aging60to90 > 0) {
                            row.classList.add('aging-60-90');
                        } else if (customer.aging45to60 > 0) {
                            row.classList.add('aging-45-60');
                        } else if (customer.aging30to45 > 0) {
                            row.classList.add('aging-30-45');
                        }
                    }
                    
                    row.innerHTML = `
                        <td>${customer.customer}</td>
                        <td class="amount-col">${customer.billed.toLocaleString('en-IN')}</td>
                        <td class="amount-col ${customer.overdue > 0 ? 'cash-outflow-cell' : ''}">${customer.overdue.toLocaleString('en-IN')}</td>
                        <td class="amount-col ${customer.notDue > 0 ? 'cash-inflow-cell' : ''}">${customer.notDue.toLocaleString('en-IN')}</td>
                        <td class="amount-col aging-0-30">${customer.aging0to30.toLocaleString('en-IN')}</td>
                        <td class="amount-col aging-30-45">${customer.aging30to45.toLocaleString('en-IN')}</td>
                        <td class="amount-col aging-45-60">${customer.aging45to60.toLocaleString('en-IN')}</td>
                        <td class="amount-col aging-60-90">${customer.aging60to90.toLocaleString('en-IN')}</td>
                        <td class="amount-col aging-90-120">${customer.aging90to120.toLocaleString('en-IN')}</td>
                        <td class="amount-col aging-120-365">${customer.aging120to365.toLocaleString('en-IN')}</td>
                        <td class="amount-col">${customer.unbilled.toLocaleString('en-IN')}</td>
                        <td class="actions-col">
                            <button class="btn btn-warning btn-sm edit-btn"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-btn"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                // Add summary row
                const totalBilled = data.reduce((sum, c) => sum + c.billed, 0);
                const totalOverdue = data.reduce((sum, c) => sum + c.overdue, 0);
                const totalNotDue = data.reduce((sum, c) => sum + c.notDue, 0);
                const total0to30 = data.reduce((sum, c) => sum + c.aging0to30, 0);
                const total30to45 = data.reduce((sum, c) => sum + c.aging30to45, 0);
                const total45to60 = data.reduce((sum, c) => sum + c.aging45to60, 0);
                const total60to90 = data.reduce((sum, c) => sum + c.aging60to90, 0);
                const total90to120 = data.reduce((sum, c) => sum + c.aging90to120, 0);
                const total120to365 = data.reduce((sum, c) => sum + c.aging120to365, 0);
                const totalUnbilled = data.reduce((sum, c) => sum + c.unbilled, 0);
                
                const summaryRow = document.createElement('tr');
                summaryRow.classList.add('summary-row');
                summaryRow.innerHTML = `
                    <td><strong>Total</strong></td>
                    <td class="amount-col"><strong>${totalBilled.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col ${totalOverdue > 0 ? 'cash-outflow-cell' : ''}"><strong>${totalOverdue.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col ${totalNotDue > 0 ? 'cash-inflow-cell' : ''}"><strong>${totalNotDue.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${total0to30.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${total30to45.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${total45to60.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${total60to90.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${total90to120.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${total120to365.toLocaleString('en-IN')}</strong></td>
                    <td class="amount-col"><strong>${totalUnbilled.toLocaleString('en-IN')}</strong></td>
                    <td></td>
                `;
                
                tbody.appendChild(summaryRow);
            }
            
            // Function to update summary cards
            function updateSummaryCards() {
                const totalBilled = agingData.reduce((sum, c) => sum + c.billed, 0);
                const totalOverdue = agingData.reduce((sum, c) => sum + c.overdue, 0);
                const totalNotDue = agingData.reduce((sum, c) => sum + c.notDue, 0);
                const totalUnbilled = agingData.reduce((sum, c) => sum + c.unbilled, 0);
                const total30to45 = agingData.reduce((sum, c) => sum + c.aging30to45, 0);
                const total45to60 = agingData.reduce((sum, c) => sum + c.aging45to60, 0);
                const total60to90 = agingData.reduce((sum, c) => sum + c.aging60to90, 0);
                const total90Plus = agingData.reduce((sum, c) => sum + c.aging90to120 + c.aging120to365, 0);
                
                // Update card values
                const cards = document.querySelectorAll('.summary-card');
                
                // Total Billed OS card
                cards[0].querySelector('.card-value').textContent = '₹' + totalBilled.toLocaleString('en-IN');
                
                // Total Overdue OS card
                cards[1].querySelector('.card-value').textContent = '₹' + totalOverdue.toLocaleString('en-IN');
                
                // Not Due Amount card
                cards[2].querySelector('.card-value').textContent = '₹' + totalNotDue.toLocaleString('en-IN');
                
                // Total Unbilled card
                cards[3].querySelector('.card-value').textContent = '₹' + totalUnbilled.toLocaleString('en-IN');
                
                // 30-45 Days card
                cards[4].querySelector('.card-value').textContent = '₹' + total30to45.toLocaleString('en-IN');
                
                // 45-60 Days card
                cards[5].querySelector('.card-value').textContent = '₹' + total45to60.toLocaleString('en-IN');
                
                // 60-90 Days card
                cards[6].querySelector('.card-value').textContent = '₹' + total60to90.toLocaleString('en-IN');
                
                // 90+ Days card
                cards[7].querySelector('.card-value').textContent = '₹' + total90Plus.toLocaleString('en-IN');
            }
        });
    </script>
</body>
</html>
